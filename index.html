<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>æ–°å¹´çƒŸèŠ± | è‡ªåŠ¨+ç‚¹å‡»æ”¾çƒŸèŠ±ğŸ†</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        body {
            overflow: hidden;
            background: #000;
            touch-action: none;
        }
        canvas {
            display: block;
            width: 100vw;
            height: 100vh;
        }
        .tip {
            position: fixed;
            top: 20px;
            left: 50%;
            transform: translateX(-50%);
            color: #fff;
            font-size: 16px;
            text-shadow: 0 0 5px #ff0;
            z-index: 10;
        }
    </style>
</head>
<body>
    <div class="tip">è‡ªåŠ¨ç‡ƒæ”¾çƒŸèŠ±ğŸ† | ç‚¹å‡»å±å¹•æ”¾çƒŸèŠ±ï¼ˆä»…çˆ†ç‚¸ï¼‰</div>
    <canvas id="fireworksCanvas"></canvas>

    <!-- 1. çƒŸèŠ±ä¸Šå‡éŸ³æ•ˆ -->
    <audio id="riseSound" preload="auto" style="display: none;">
        <source src="rise.mp3" type="audio/mpeg">
    </audio>
    <!-- 2. çˆ†ç‚¸éŸ³æ•ˆ1 -->
    <audio id="boomSound1" preload="auto" style="display: none;">
        <source src="boom1.mp3" type="audio/mpeg">
    </audio>
    <!-- 3. çˆ†ç‚¸éŸ³æ•ˆ2 -->
    <audio id="boomSound2" preload="auto" style="display: none;">
        <source src="boom2.mp3" type="audio/mpeg">
    </audio>

    <script>
        // è·å–Canvaså’ŒéŸ³é¢‘å…ƒç´ 
        const canvas = document.getElementById('fireworksCanvas');
        const ctx = canvas.getContext('2d');
        const riseSound = document.getElementById('riseSound');
        const boomSound1 = document.getElementById('boomSound1');
        const boomSound2 = document.getElementById('boomSound2');
        let audioInited = false; // å¾®ä¿¡éŸ³é¢‘è§£é”æ ‡è®°

        // é€‚é…å±å¹•å¤§å°
        function resizeCanvas() {
            canvas.width = window.innerWidth;
            canvas.height = window.innerHeight;
        }
        resizeCanvas();
        window.addEventListener('resize', resizeCanvas);

        // éšæœºæ•°å·¥å…·å‡½æ•°
        function random(min, max) {
            return Math.random() * (max - min) + min;
        }

        // éšæœºé¢œè‰²å‡½æ•°
        function randomColor() {
            const colors = [
                '#ff0000', '#ff9900', '#ffff00', '#00ff00',
                '#0099ff', '#0033ff', '#9900ff', '#ff0099'
            ];
            return colors[Math.floor(random(0, colors.length))];
        }

        // ğŸ”´ å¾®ä¿¡éŸ³é¢‘è§£é”ï¼ˆç¬¬ä¸€æ¬¡äº¤äº’æ—¶æ‰§è¡Œï¼‰
        function initAudio() {
            if (!audioInited) {
                [riseSound, boomSound1, boomSound2].forEach(audio => {
                    audio.play().then(() => {
                        audio.pause();
                        audio.currentTime = 0;
                    }).catch(() => {});
                });
                audioInited = true;
            }
        }

        // ğŸ”´ æ’­æ”¾éšæœºçˆ†ç‚¸éŸ³æ•ˆï¼ˆç‚¹å‡»çƒŸèŠ±ä¸“ç”¨ï¼‰
        function playBoomSound() {
            const randomBoom = Math.random() > 0.5 ? boomSound1 : boomSound2;
            randomBoom.currentTime = 0;
            randomBoom.play().catch(err => console.log("çˆ†ç‚¸éŸ³æ•ˆæ’­æ”¾å¤±è´¥ï¼š", err));
        }

        // ğŸ”´ æ’­æ”¾ä¸Šå‡+çˆ†ç‚¸éŸ³æ•ˆï¼ˆè‡ªåŠ¨çƒŸèŠ±ä¸“ç”¨ï¼‰
        function playRiseAndBoomSound() {
            // 1. æ’­æ”¾ä¸Šå‡éŸ³æ•ˆ
            riseSound.currentTime = 0;
            riseSound.play().catch(err => console.log("ä¸Šå‡éŸ³æ•ˆæ’­æ”¾å¤±è´¥ï¼š", err));

            // 2. å»¶è¿Ÿæ’­æ”¾çˆ†ç‚¸éŸ³æ•ˆï¼ˆåŒ¹é…ä¸Šå‡æ—¶é•¿ï¼Œå¯è°ƒæ•´ï¼‰
            setTimeout(() => {
                playBoomSound(); // å¤ç”¨éšæœºçˆ†ç‚¸éŸ³æ•ˆé€»è¾‘
            }, 500); // å»¶è¿Ÿ500msï¼Œå¯æ ¹æ®ä½ çš„ä¸Šå‡éŸ³æ•ˆé•¿åº¦è°ƒæ•´
        }

        // ç”ŸæˆçƒŸèŠ±ç²’å­ï¼ˆæ ¸å¿ƒæ¸²æŸ“é€»è¾‘ï¼‰
        function createFireworkParticles(x, y) {
            const color = randomColor();
            const particleCount = random(100, 150);
            for (let i = 0; i < particleCount; i++) {
                const p = new Particle(x, y, color);
                particles.push(p);
            }
        }

        // ç²’å­ç±»
        class Particle {
            constructor(x, y, color) {
                this.x = x;
                this.y = y;
                this.speed = random(1, 5);
                this.angle = random(0, Math.PI * 2);
                this.gravity = 0.05;
                this.vx = Math.cos(this.angle) * this.speed;
                this.vy = Math.sin(this.angle) * this.speed;
                this.alpha = 1;
                this.decay = random(0.005, 0.01);
                this.color = color;
            }
            update() {
                this.vy += this.gravity;
                this.x += this.vx;
                this.y += this.vy;
                this.alpha -= this.decay;
            }
            draw() {
                ctx.save();
                ctx.globalAlpha = this.alpha;
                ctx.beginPath();
                ctx.arc(this.x, this.y, 2, 0, Math.PI * 2);
                ctx.fillStyle = this.color;
                ctx.fill();
                ctx.restore();
            }
        }

        // å­˜å‚¨ç²’å­
        let particles = [];

        // ğŸ”´ ç‚¹å‡»è§¦å‘çƒŸèŠ±ï¼ˆä»…çˆ†ç‚¸éŸ³æ•ˆï¼‰
        function clickFirework(x, y) {
            initAudio(); // è§£é”éŸ³é¢‘
            playBoomSound(); // åªæ’­æ”¾çˆ†ç‚¸éŸ³æ•ˆ
            createFireworkParticles(x, y); // ç”ŸæˆçƒŸèŠ±ç²’å­
        }

        // ğŸ”´ è‡ªåŠ¨è§¦å‘çƒŸèŠ±ï¼ˆä¸Šå‡+çˆ†ç‚¸éŸ³æ•ˆï¼Œéšæœºä½ç½®ï¼‰
        function autoFirework() {
            initAudio(); // è§£é”éŸ³é¢‘
            // éšæœºç”Ÿæˆå±å¹•å†…çš„ä½ç½®ï¼ˆé¿å…è¾¹ç¼˜ï¼‰
            const x = random(canvas.width * 0.2, canvas.width * 0.8);
            const y = random(canvas.height * 0.2, canvas.height * 0.7);
            
            playRiseAndBoomSound(); // ä¸Šå‡+çˆ†ç‚¸éŸ³æ•ˆ
            createFireworkParticles(x, y); // ç”ŸæˆçƒŸèŠ±ç²’å­
        }

        // åŠ¨ç”»å¾ªç¯
        function animate() {
            ctx.fillStyle = 'rgba(0, 0, 0, 0.1)';
            ctx.fillRect(0, 0, canvas.width, canvas.height);
            
            for (let i = particles.length - 1; i >= 0; i--) {
                const p = particles[i];
                p.update();
                p.draw();
                if (p.alpha <= 0) particles.splice(i, 1);
            }
            requestAnimationFrame(animate);
        }

        // ğŸ”´ å¯åŠ¨è‡ªåŠ¨ç‡ƒæ”¾ï¼ˆæ¯2-3ç§’éšæœºè§¦å‘ä¸€æ¬¡ï¼Œå¯è°ƒæ•´ï¼‰
        function startAutoFirework() {
            // ç«‹å³è§¦å‘ä¸€æ¬¡
            autoFirework();
            // å®šæ—¶å¾ªç¯è§¦å‘ï¼ˆéšæœºé—´éš”2000-3000msï¼Œé¿å…æœºæ¢°æ„Ÿï¼‰
            setInterval(() => {
                autoFirework();
            }, random(2000, 3000));
        }

        // ç›‘å¬ç‚¹å‡»/è§¦æ‘¸äº‹ä»¶ï¼ˆç‚¹å‡»æ”¾çƒŸèŠ±ï¼‰
        canvas.addEventListener('click', (e) => clickFirework(e.clientX, e.clientY));
        canvas.addEventListener('touchstart', (e) => {
            e.preventDefault();
            const touch = e.touches[0];
            clickFirework(touch.clientX, touch.clientY);
        }, { passive: false });

        // å¯åŠ¨åŠ¨ç”»+è‡ªåŠ¨ç‡ƒæ”¾
        animate();
        startAutoFirework();
    </script>
</body>
</html>